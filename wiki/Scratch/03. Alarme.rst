3 Projet : Système d'alarme
~~~~~~~~~~~~~~~~~~~~~~~~~~

Dans ce projet, nous utilisons un capteur de mouvement PIR et un buzzer pour constituer un système d'alarme, qui peut être contrôlé par une carte de développement ESP32.

Comment cela fonctionne-t-il ? Les signaux électriques sont détectés et lus par le capteur de mouvement PIR via une programmation sur l'IDE Arduino, puis il détermine s'il y a une personne. Si c'est le cas, le buzzer sonne. Ainsi, ce système d'alarme coûte beaucoup moins cher pour les familles et les bureaux.

--------------

3.1 Diagramme de flux
^^^^^^^^^^^^^^^^^^^^^

.. image:: ./scratch_img/image-20230606102303743.png
   :alt: image-20230606102303743

--------------

3.2 Capteur de mouvement PIR
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Description :**

Un capteur de mouvement PIR détecte la présence d'une personne en détectant la chaleur émise par le corps humain.

De plus, ce capteur est petit et facile à utiliser.

.. image:: ./scratch_img/cou32.png
   :alt: img

--------------

**Schéma :**

.. image:: ./scratch_img/couy31.png
   :alt: img

**Paramètres :**

- Tension : 3~5V
- Courant : 3,6mA
- Puissance : 18mW
- Angle de vue : Y = 90°, X = 110° (valeur théorique)
- Distance de détection : ≤5m

--------------

**Schéma de câblage :**

**Connectez le capteur de mouvement PIR à io23.**

**Attention : Connectez le fil jaune à S(Signal), le fil rouge à V(Alimentation), et le fil noir à GND. Ne les inversez pas !**

.. image:: ./scratch_img/couj31.png
   :alt: img

--------------

**Code de test :**

Lisez la valeur sur la broche IO23 pour déterminer s'il y a un mouvement humain.

.. image:: ./scratch_img/image-20250423083305405.png
   :alt: image-20250423083305405

**Résultat du test :**

Ouvrez le moniteur série.

Lorsqu'une personne se trouve dans la zone, **Quelqu'un** s'affiche sur le moniteur, et la LED rouge du capteur s'éteint. Cependant, s'il n'y a personne, **Personne** sera affiché et la LED restera toujours allumée.

**ATTENTION** : Le capteur de mouvement PIR ne peut pas pénétrer les objets, donc ne couvrez pas le capteur lors de la détection de mouvements.

.. image:: ./scratch_img/st57.png
   :alt: img

--------------

3.3 Buzzer
^^^^^^^^^^

**Description :**

Un buzzer est un avertisseur électronique, qui émet des sons de différentes fréquences et durées et est alimenté par une tension continue. Il peut donc être utilisé comme rappel ou alarme dans de nombreux appareils électroniques, tels que les ordinateurs, imprimantes, copieurs, alarmes, jouets électroniques, électronique automobile, téléphones et minuteries.

.. image:: ./scratch_img/cou3png
   :alt: img

--------------

Un buzzer se compose d'un **dispositif de vibration** et d'un **dispositif de résonance**. Il existe deux catégories : buzzers passifs et buzzers actifs.

- Un **buzzer passif** ne peut pas « vibrer » pour émettre un son par lui-même, sauf si on lui applique un signal en « onde carrée » d'une certaine fréquence. De plus, le son émis varie selon la fréquence de l'onde carrée, donc un buzzer passif peut simuler des mélodies.

   - Une onde carrée analogique peut être générée en changeant le niveau d'alimentation aux broches. Par exemple, après un niveau haut de 500ms, il passe à un niveau bas pour 500ms, puis à nouveau à un niveau haut...
   - *Nous pilotons le buzzer via une onde carrée entre 200~5000Hz, et nous pouvons calculer la fréquence (f) : f=1/T ; T est la période (temps total de niveau haut et bas).*  

.. image:: ./scratch_img/cou35.png
   :alt: img

- Un **buzzer actif** peut émettre un son automatiquement sans stimulateur externe, car il comporte un circuit de pilotage qui nécessite seulement une alimentation en tension continue. Toutefois, son son est monotone avec une fréquence relativement fixe.

--------------

**Dans cette expérience, un buzzer passif est utilisé pour « jouer de la musique ».**

--------------

**Schéma :**

.. image:: ./scratch_img/cou38.png
   :alt: img

**Paramètres :**

- Tension : 3~5V
- Courant : ≤5mA
- Puissance : ≤25mW

--------------

**Schéma de câblage :**

**Connectez le buzzer à io16.**

**Attention : Connectez le fil jaune à S(Signal), le fil rouge à V(Alimentation), et le fil noir à GND. Ne les inversez pas !**

.. image:: ./scratch_img/couj32.png
   :alt: img

--------------

**Code de test :**

**Méthode 1 : Onde carrée analogique**

Un buzzer passif est piloté par des ondes carrées, donc nous simulons l’onde.

Une onde carrée analogique peut être générée en changeant le niveau d’alimentation de la broche : niveau haut pendant 500us et niveau bas pendant 500us. Ainsi, le buzzer émettra un son. De plus, la durée peut ajuster le volume sonore.

Essayez 1000us, 1500us, 3000us... Quelle est la différence ?

.. image:: ./scratch_img/cou36.png
   :alt: img

Code :

.. image:: ./scratch_img/st58.png
   :alt: img

- Dans la fonction de délai, l’unité de temps est la microseconde. Donc, le bloc suivant représente un délai de 500ms.

.. image:: ./scratch_img/st59.png
   :alt: img

Selon la formule :

.. math:: f = 1/T

Ainsi, 500us est la durée, et nous pouvons calculer la fréquence = 2kHz, c’est-à-dire que le niveau haut et bas alterne 2000 fois par seconde.

--------------

**Méthode 2 : Blocs haut-parleur**

Nous utilisons des blocs de code Speaker|image24| pour piloter le buzzer afin qu’il vibre.

**Les blocs Speaker génèrent un signal PWM d'une certaine fréquence pour piloter le buzzer,** et la durée et le ton sont contrôlés par les paramètres associés.

Il existe deux façons de définir la durée. L'une consiste à ajuster les paramètres de la fonction tone() pour définir une durée, et l'autre consiste à utiliser la fonction noTone() pour arrêter directement le son. Si vous ne définissez pas de durée dans tone(), le signal sonore sera toujours généré sauf si un noTone() l’arrête.

Pour la carte ESP32, un seul son peut être produit à la fois. Si une broche de l’ESP32 génère un signal sonore via tone(), il n’est pas possible d’émettre un son par cette fonction sur une autre broche.

**Table des tons**

.. image:: ./scratch_img/cou37.png
   :alt: img

Code :

- Faites glisser un bloc « Tone » depuis |image25| comme indiqué ci-dessous, et réglez la broche sur IO16.

   .. image:: ./scratch_img/st61.png
      :alt: img

- Vous pouvez sélectionner une fréquence au choix.

   .. image:: ./scratch_img/st62.png
      :alt: img

- No Tone : il est utilisé pour désactiver tous les tons.

   .. image:: ./scratch_img/st65.png
      :alt: img

Code complet :

.. image:: ./scratch_img/st63.png
   :alt: img

**Résultat du test :**

Méthode 1 : Le buzzer émet un son en continu.

Méthode 2 : Le buzzer sonne via la fonction tone().

--------------

**Extension : Jouer de la musique**

Jouez de la musique via tone().

Code complet :

.. image:: ./scratch_img/st6png
   :alt: img

--------------

3.4 Système d'alarme
^^^^^^^^^^^^^^^^^^^^

Dans cette expérience, nous construirons un système d’alarme avec un capteur de mouvement PIR, un buzzer et une LED. Lorsque le capteur détecte un mouvement, le buzzer émet un son et la LED clignote pour signaler une intrusion.

--------------

**Schéma de câblage :**

**Connectez le capteur de mouvement PIR à io23, le buzzer à io16 et la LED à io27.**

**Attention : Connectez le fil jaune à S(Signal), le fil rouge à V(Alimentation), et le fil noir à GND. Ne les inversez pas !**

.. image:: ./scratch_img/couj33.png
   :alt: img

--------------

**Code de test :**

Flux du code :

.. image:: ./scratch_img/flo3.png
   :alt: img

Code complet :

.. image:: ./scratch_img/image-20250423084431295.png
   :alt: image-20250423084431295

**Résultat du test :**

Téléversez le code et le système d’alarme démarre. Lorsqu’il détecte un mouvement, le buzzer sonne et la LED clignote.

--------------

3.5 FAQ
^^^^^^^

**Q : Les tons du buzzer ne sont pas précis par rapport aux vrais.**

R : Ce buzzer régulier ne fait que simuler des tons, il ne peut donc pas répondre à des exigences professionnelles. Si vous souhaitez des tons standards, un haut-parleur plus spécialisé est nécessaire.

--------------

**Q : Le capteur de mouvement PIR donne de mauvais résultats.**

R : Ce capteur de mouvement PIR n’est pas non plus professionnel.

Veuillez garantir les conditions suivantes pour éviter les mauvaises interprétations :

- Évitez les objets soufflés par le vent qui flottent dans la zone de détection, comme les rideaux, vêtements et fleurs.
- Évitez les lumières fortes dans la zone de détection, telles que la lumière du soleil, les phares de voiture, projecteurs et autres sources de lumière.
- Etc...