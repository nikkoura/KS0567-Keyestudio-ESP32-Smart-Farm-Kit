6 Projet : Système d'alimentation intelligent
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Dans ce projet, le module ultrasonique détecte si des animaux se trouvent dans la zone d'alimentation, et le Servo ouvre automatiquement la boîte d'alimentation pour les volailles. De plus, l'incorporation de l'IOT permet la surveillance à distance de ces systèmes d'alimentation, ce qui offre beaucoup de commodité.

Dans l'ensemble, l'automatisation et l'opération à distance optimisent le processus d'alimentation pour ce système.

.. image:: ./scratch_img/cout6.png
   :alt: img

--------------



6.1 Diagramme de flux
^^^^^^^^^^^^^^^^^^^^

.. image:: ./scratch_img/image-20230607085516167.png
   :alt: image-20230607085516167

--------------



6.2 Servo
^^^^^^^^^^

**Description :**

**Servo**, également appelé **dispositif Servo RC**, est un moteur avec retour d'information. En général, le Servo effectue un contrôle de position précis et produit un couple élevé, ce qui apparaît le plus souvent dans des projets de robotique, des voitures RC, des avions et des aéronefs.

.. image:: ./scratch_img/cou64.png
   :alt: img

--------------

**Structure interne :**

.. image:: ./scratch_img/cou61.png
   :alt: img

-  ① Signal(S) : Il reçoit le signal de contrôle du microcontrôleur.
-  ② Potentiomètre : la partie de retour d'information du Servo. Il mesure la position de l'arbre de sortie.
-  ③ Carte intégrée (contrôleur interne) : le cœur du Servo. Il traite le signal de contrôle externe et le signal de retour d'information de position et entraîne le Servo.
-  ④ Moteur CC : la partie d'exécution. Il produit la vitesse, le couple et la position.
-  ⑤ Système d'engrenage : Il adapte les sorties du moteur à l'angle de sortie final selon un certain rapport de transmission.

--------------

**Contrôler le Servo :**

Le Signal(S) reçoit PWM pour contrôler la sortie du Servo, et **la position de l'arbre de sortie dépend directement du rapport cyclique de PWM**.

Par exemple :

-  Si nous envoyons un signal avec une largeur d'impulsion de 1,5 ms au Servo, son arbre (corne) tournera à la position médiane (90°) ;
-  Si la largeur d'impulsion = ``0,5 ms``, l'arbre tourne à son minimum (0°) ;
-  Si la largeur d'impulsion = ``2,5 ms``, l'arbre tourne à son maximum (180°).

**REMARQUE : L'angle maximum varie selon les types de Servos. Certains sont à 170° tandis que d'autres ne sont qu'à 90°. Malgré cela, les Servos se déplaceront généralement de la moitié (du maximum) s'ils reçoivent un signal avec une largeur d'impulsion de 1,5 ms.**

.. image:: ./scratch_img/cou62.png
   :alt: img

La période d'un Servo dure généralement 20 ms et il produit des impulsions à une fréquence de ``50 Hz``. La plupart des servos fonctionnent normalement à 40~200 Hz.

--------------

**Schéma de câblage :**

**Connectez le Servo à io26.**

**Attention : Connectez le jaune à S (Signal), le rouge à V (Alimentation), et le noir à GND. Ne les inversez pas !**

.. image:: ./scratch_img/couj61.png
   :alt: img

--------------

**Code de test :**

-  Initialisez le port série et définissez une variable **item** avec une valeur de 80.

   .. image:: ./scratch_img/st78.png
      :alt: img

-  Réglez **item** sur l'angle du Servo de 80° à 180°, en tournant de 1° toutes les 15 ms.

   .. image:: ./scratch_img/st79.png
      :alt: img

-  Le Servo tourne de 1° toutes les 15 ms, de 180° à 80°.

   .. image:: ./scratch_img/st80.png
      :alt: img

Code complet :

.. image:: ./scratch_img/st81.png
   :alt: img

**Résultat du test :**

La boîte d'alimentation s'ouvre lentement puis se ferme, ce qui est contrôlable.

**REMARQUE : Le servo SG90 peut tourner à 180°. Comme la boîte d'alimentation est petite, 100° de rotation suffisent pour fermer complètement la boîte.**

-  80° : complètement ouverte
-  120° : à moitié ouverte
-  180° : fermée

.. image:: ./scratch_img/cou63.gif
   :alt: img

--------------

**ATTENTION**

\**Ne mettez pas vos doigts dans la boîte pour éviter de vous pincer ! \*\*

**Ne bloquez pas la porte avec quelque chose pour éviter d'endommager le servo !**

--------------



6.3 Capteur ultrasonique
^^^^^^^^^^^^^^^^^^^^^^^^

**Description :**

.. image:: ./scratch_img/cou65.png
   :alt: img

**Schéma :**

.. image:: ./scratch_img/couy61.png
   :alt: img

--------------

La fréquence des ondes sonores que l'homme peut entendre est de 20 Hz à 20 KHz, tandis que les ondes ultrasoniques dépassent cette plage.

**Ultrasonique :**

.. image:: ./scratch_img/cou66.png
   :alt: img

Le module ultrasonique convertit l'électricité et l'onde ultrasonique l'une dans l'autre par effet piézoélectrique, et il transmet également et reçoit l'onde ultrasonique.

Ce type d'onde se caractérise par sa directivité, sa forte pénétration et sa facilité de concentration de l'énergie sonore.

.. image:: ./scratch_img/cou67.png
   :alt: img

Dans ce système de mesure ultrasonique, nous programmons d'abord sur le MCU (carte de développement ESP32) pour générer une onde carrée originale à 40 KHz et entraîner le module ultrasonique à l'émettre. Immédiatement, le module calcule la distance à l'objet après avoir reçu l'onde réfléchie (Echo) amplifiée et façonnée par le circuit. Ici, il enregistre la durée d'émission et de réflexion et calcule la distance en fonction de la différence de temps.

En résumé, le MCU contrôle le module pour émettre une onde ultrasonique qui est renvoyée après avoir rencontré des obstacles et est reçue par le module. La différence de temps entre elles est un facteur important dans le calcul de la distance (la vitesse de propagation du son dans l'air est de 340 m/s).

--------------

**Schéma de câblage :**

**Connectez l'Echo du module ultrasonique à io13 et Trig à io12.**

**Attention : Connectez le jaune à S (Signal) et le rouge à V (Alimentation). Ne les inversez pas !**

.. image:: ./scratch_img/couj62.png
   :alt: img

--------------

**Code de test :**

Réglez le bon pin : Trig sur le pin io12 ; Echo sur le pin io13.

.. image:: ./scratch_img/st83.png
   :alt: img

**Résultat du test :**

Dans ce kit, la plage de détection est de 3 à 8 cm.

Ouvrez le moniteur série et observez.

.. image:: ./scratch_img/st82.png
   :alt: img

--------------



6.4 Système d'alimentation intelligent
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Description :**

Le système d'alimentation intelligent nourrit intelligemment les volailles domestiques via un module ultrasonique et un servo. Le premier détecte la distance aux animaux tandis que le second contrôle l'ouverture ou la fermeture de la boîte d'alimentation. Lorsqu'un animal de compagnie est détecté près de la boîte, le servo l'ouvre pour nourrir.

--------------

**Schéma de câblage :**

**Connectez l'Echo du module ultrasonique à io13 et Trig à io12 ; connectez le servo à io26.**

**Attention : Connectez le jaune à S (Signal), le rouge à V (Alimentation) et le noir à GND. Ne les inversez pas !**

.. image:: ./scratch_img/couj63.png
   :alt: img

--------------

**Code de test :**

Flux de code :

.. image:: ./scratch_img/flo6.png
   :alt: img

Code :

-  Initialisez le port série. Définissez une variable et assignez-lui la valeur 180.

   .. image:: ./scratch_img/st84.png
      :alt: img

-  Réglez correctement le pin et imprimez la valeur reçue.

   .. image:: ./scratch_img/st85.png
      :alt: img

-  Déterminez la valeur de distance détectée. Si elle est comprise entre 2 cm et 7 cm, la boîte d'alimentation s'ouvrira.

   .. image:: ./scratch_img/st86.png
      :alt: img

Code complet :

.. image:: ./scratch_img/st87.png
   :alt: img

**Résultat du test :**

Lorsqu'un animal est détecté, ouvrez la boîte d'alimentation.

--------------

**ATTENTION**

\**Ne mettez pas vos doigts dans la boîte pour éviter de vous pincer ! \*\*

**Ne bloquez pas la porte avec quelque chose pour éviter d'endommager le servo !**

--------------



6.5 FAQ
^^^^^^^^^

Q : Le Servo ne fonctionne pas.

R : Il peut être bloqué par lui-même ou par des fils lors du montage de la plaque inférieure. Avant d'installer, veuillez d'abord ajuster le servo à 180°. Pour cela, veuillez vous référer au guide d'installation.

--------------

Q : La distance détectée est inexacte.

R : Lors de la détection, veuillez mesurer depuis la tête d'émission. Ici, ce module n'est pas un détecteur de haute précision, donc des erreurs peuvent exister.

.. image:: ./scratch_img/cou69.png
   :alt: img

--------------
```


